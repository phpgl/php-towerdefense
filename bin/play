#!/usr/bin/env php
<?php

use VISU\Graphics\GLState;

if (!defined('DS')) { define('DS', DIRECTORY_SEPARATOR); }

set_time_limit(0);

/**
 *---------------------------------------------------------------
 * Autoloader / Compser
 *---------------------------------------------------------------
 *
 * We need to access our dependencies & autloader..
 */
$container = require __DIR__ . DS . '..' . DS . 'bootstrap.php';

glfwInit();

$gl = new GLState;

$window = new VISU\OS\Window('PHP Tower Defense');
$window->initailize($gl);

// register a key callback to hnadle ESC key
$window->setKeyCallback(function($key, $scancode, $action, $mods) use ($window) {
    if ($key == GLFW_KEY_ESCAPE && $action == GLFW_PRESS) {
        $window->setShouldClose(true);
    }

    // when pressing m maximise the window
    if ($key == GLFW_KEY_M && $action == GLFW_PRESS) {
        if ($window->isMaximized()) {
            $window->restore();
        } else {
            $window->maximize();
        }
    }

    // when pressing i toggle the window iconify state
    if ($key == GLFW_KEY_I && $action == GLFW_PRESS) {
        if ($window->isIconified()) {
            $window->restore();
        } else {
            $window->iconify();
        }
    }

});

while(!$window->shouldClose()) {
    $window->pollEvents();

    glClearColor(0.0, 0.0, 0.0, 1.0);
    glClear(GL_COLOR_BUFFER_BIT);

    $window->swapBuffers();
}


glfwTerminate();